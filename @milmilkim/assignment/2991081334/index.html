<link rel="preload" as="image" href="https://github.com/user-attachments/assets/107deb56-8fb0-4e1e-a0ee-a1023a1b6534"/><div data-slot="sidebar-wrapper" style="--sidebar-width:16rem;--sidebar-width-icon:3rem" class="group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full"><div class="min-h-screen flex w-full"><div class="group peer text-sidebar-foreground hidden md:block" data-state="expanded" data-collapsible="" data-variant="sidebar" data-side="left" data-slot="sidebar"><div data-slot="sidebar-gap" class="relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear group-data-[collapsible=offcanvas]:w-0 group-data-[side=right]:rotate-180 group-data-[collapsible=icon]:w-(--sidebar-width-icon)"></div><div data-slot="sidebar-container" class="fixed inset-y-0 z-10 hidden h-svh transition-[left,right,width] duration-200 ease-linear md:flex left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)] group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l w-64"><div data-sidebar="sidebar" data-slot="sidebar-inner" class="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"><div data-slot="sidebar-content" data-sidebar="content" class="flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden bg-card border-r border-border"><a class="p-4" href="/front_7th/" data-discover="true"><div class="flex items-center space-x-2 mb-6"><div class="w-8 h-8 bg-gradient-primary rounded-lg flex items-center justify-center"><span class="text-white font-bold text-sm">7기</span></div><h4 class="text-lg font-bold text-primary">항해플러스 프론트엔드</h4></div></a><div data-slot="sidebar-group" data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><div data-slot="sidebar-group-label" data-sidebar="group-label" class="ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 text-muted-foreground px-4">학습 관리</div><div data-slot="sidebar-group-content" data-sidebar="group-content" class="w-full text-sm"><ul data-slot="sidebar-menu" data-sidebar="menu" class="flex w-full min-w-0 flex-col gap-1 px-2"><li data-slot="sidebar-menu-item" data-sidebar="menu-item" class="group/menu-item relative"><a data-slot="sidebar-menu-button" data-sidebar="menu-button" data-size="default" data-active="false" class="peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-hidden ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground text-sm h-12 text-foreground hover:bg-secondary hover:text-secondary-foreground rounded-lg transition-all duration-300" href="/front_7th/" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users h-5 w-5" aria-hidden="true"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><path d="M16 3.128a4 4 0 0 1 0 7.744"></path><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><circle cx="9" cy="7" r="4"></circle></svg><span class="ml-3">수강생 목록</span></a></li><li data-slot="sidebar-menu-item" data-sidebar="menu-item" class="group/menu-item relative"><a data-slot="sidebar-menu-button" data-sidebar="menu-button" data-size="default" data-active="false" class="peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-hidden ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground text-sm h-12 text-foreground hover:bg-secondary hover:text-secondary-foreground rounded-lg transition-all duration-300" href="/front_7th/assignments/" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open h-5 w-5" aria-hidden="true"><path d="M12 7v14"></path><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path></svg><span class="ml-3">과제 목록</span></a></li></ul></div></div></div></div></div></div><div class="flex-1 min-w-0"><header class="h-12 flex items-center border-b border-border bg-card px-4"><button data-slot="sidebar-trigger" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 size-7 mr-4 text-white" data-sidebar="trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-panel-left" aria-hidden="true"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path></svg><span class="sr-only">Toggle Sidebar</span></button><h4 class="text-lg font-semibold "><a href="/front_7th/@milmilkim/" data-discover="true">milmilkim<!-- --> 님의 상세페이지</a> ＞ <!-- -->[6팀 김소리] Chapter2-1. 프레임워크 없이 SPA 만들기 </h4></header><main class="p-6"><div><div class="card-wrap"><div data-slot="card" class="card text-card-foreground flex flex-col gap-6 shadow-sm mb-6 p-6 border border-gray-700 bg-gray-800 rounded-lg"><a href="https://github.com/hanghae-plus/front_7th_chapter2-1/pull/4" target="_blank"><div class="flex items-start gap-4"><div class="flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" height="32" aria-hidden="true" viewBox="0 0 24 24" width="32" fill="white" class="w-8 h-8"><path d="M12 1C5.923 1 1 5.923 1 12c0 4.867 3.149 8.979 7.521 10.436.55.096.756-.233.756-.522 0-.262-.013-1.128-.013-2.049-2.764.509-3.479-.674-3.699-1.292-.124-.317-.66-1.293-1.127-1.554-.385-.207-.936-.715-.014-.729.866-.014 1.485.797 1.691 1.128.99 1.663 2.571 1.196 3.204.907.096-.715.385-1.196.701-1.471-2.448-.275-5.005-1.224-5.005-5.432 0-1.196.426-2.186 1.128-2.956-.111-.275-.496-1.402.11-2.915 0 0 .921-.288 3.024 1.128a10.193 10.193 0 0 1 2.75-.371c.936 0 1.871.123 2.75.371 2.104-1.43 3.025-1.128 3.025-1.128.605 1.513.221 2.64.111 2.915.701.77 1.127 1.747 1.127 2.956 0 4.222-2.571 5.157-5.019 5.432.399.344.743 1.004.743 2.035 0 1.471-.014 2.654-.014 3.025 0 .289.206.632.756.522C19.851 20.979 23 16.854 23 12c0-6.077-4.922-11-11-11Z"></path></svg></div><div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-2"><h3 class="text-lg font-semibold text-white truncate">[6팀 김소리] Chapter2-1. 프레임워크 없이 SPA 만들기 </h3></div><div class="flex items-center gap-4 text-xs text-gray-500"><span>by <!-- -->milmilkim</span><span>2025.11.08</span></div></div></div></a></div></div><div class="overflow-auto"><div data-color-mode="dark" class="wmde-markdown wmde-markdown-color p-6 max-w-full" style="word-wrap:break-word;overflow-wrap:break-word"><h2 id="과제-체크포인트"><a class="anchor" aria-hidden="true" tabindex="-1" href="#과제-체크포인트"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>과제 체크포인트</h2>
<h3 id="배포-링크"><a class="anchor" aria-hidden="true" tabindex="-1" href="#배포-링크"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>배포 링크</h3>
<!-- -->
<p><a href="https://milmilkim.github.io/front_7th_chapter2-1/">https://milmilkim.github.io/front_7th_chapter2-1/</a></p>
<h3 id="기본과제"><a class="anchor" aria-hidden="true" tabindex="-1" href="#기본과제"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>기본과제</h3>
<h4 id="상품목록"><a class="anchor" aria-hidden="true" tabindex="-1" href="#상품목록"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>상품목록</h4>
<p><strong>상품 목록 로딩</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 페이지 접속 시 로딩 상태가 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 데이터 로드 완료 후 상품 목록이 렌더링된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 로딩 실패 시 에러 상태가 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 에러 발생 시 재시도 버튼이 제공된다</li>
</ul>
<p><strong>상품 목록 조회</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 각 상품의 기본 정보(이미지, 상품명, 가격)가 카드 형태로 표시된다</li>
</ul>
<p><strong>한 페이지에 보여질 상품 수 선택</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 드롭다운에서 10, 20, 50, 100개 중 선택할 수 있으며 기본 값은 20개 이다.</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 선택 변경 시 즉시 목록에 반영된다</li>
</ul>
<p><strong>상품 정렬 기능</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 상품을 가격순/이름순으로 오름차순/내림차순 정렬을 할 수 있다.</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 드롭다운을 통해 정렬 기준을 선택할 수 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 정렬 변경 시 즉시 목록에 반영된다</li>
</ul>
<p><strong>무한 스크롤 페이지네이션</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 페이지 하단 근처 도달 시 다음 페이지 데이터가 자동 로드된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 스크롤에 따라 계속해서 새로운 상품들이 목록에 추가된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 새 데이터 로드 중일 때 로딩 인디케이터와 스켈레톤 UI가 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 홈 페이지에서만 무한 스크롤이 활성화된다</li>
</ul>
<p><strong>상품을 장바구니에 담기</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 각 상품에 장바구니 추가 버튼이 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 버튼 클릭 시 해당 상품이 장바구니에 추가된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 추가 완료 시 사용자에게 알림이 표시된다</li>
</ul>
<p><strong>상품 검색</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 상품명 기반 검색을 위한 텍스트 입력 필드가 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> Enter 키로 검색이 수행된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 검색어와 일치하는 상품들만 목록에 표시된다</li>
</ul>
<p><strong>카테고리 선택</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 사용 가능한 카테고리들을 선택할 수 있는 UI가 제공된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 선택된 카테고리에 해당하는 상품들만 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 전체 상품 보기로 돌아갈 수 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 2단계 카테고리 구조를 지원한다 (1depth, 2depth)</li>
</ul>
<p><strong>카테고리 네비게이션</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 현재 선택된 카테고리 경로가 브레드크럼으로 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 브레드크럼의 각 단계를 클릭하여 상위 카테고리로 이동할 수 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> &quot;전체&quot; &gt; &quot;1depth 카테고리&quot; &gt; &quot;2depth 카테고리&quot; 형태로 표시된다</li>
</ul>
<p><strong>현재 상품 수 표시</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 현재 조건에서 조회된 총 상품 수가 화면에 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 검색이나 필터 적용 시 상품 수가 실시간으로 업데이트된다</li>
</ul>
<h4 id="장바구니"><a class="anchor" aria-hidden="true" tabindex="-1" href="#장바구니"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>장바구니</h4>
<p><strong>장바구니 모달</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 장바구니 아이콘 클릭 시 모달 형태로 장바구니가 열린다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> X 버튼이나 배경 클릭으로 모달을 닫을 수 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> ESC 키로 모달을 닫을 수 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 모달에서 장바구니의 모든 기능을 사용할 수 있다</li>
</ul>
<p><strong>장바구니 수량 조절</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 각 장바구니 상품의 수량을 증가할 수 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 각 장바구니 상품의 수량을 감소할 수 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 수량 변경 시 총 금액이 실시간으로 업데이트된다</li>
</ul>
<p><strong>장바구니 삭제</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 각 상품에 삭제 버튼이 배치되어 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 삭제 버튼 클릭 시 해당 상품이 장바구니에서 제거된다</li>
</ul>
<p><strong>장바구니 선택 삭제</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 각 상품에 선택을 위한 체크박스가 제공된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 선택 삭제 버튼이 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 체크된 상품들만 일괄 삭제된다</li>
</ul>
<p><strong>장바구니 전체 선택</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 모든 상품을 한 번에 선택할 수 있는 마스터 체크박스가 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 전체 선택 시 모든 상품의 체크박스가 선택된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 전체 해제 시 모든 상품의 체크박스가 해제된다</li>
</ul>
<p><strong>장바구니 비우기</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 장바구니에 있는 모든 상품을 한 번에 삭제할 수 있다</li>
</ul>
<h4 id="상품-상세"><a class="anchor" aria-hidden="true" tabindex="-1" href="#상품-상세"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>상품 상세</h4>
<p><strong>상품 클릭시 상세 페이지 이동</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 상품 목록에서 상품 이미지나 상품 정보 클릭 시 상세 페이지로 이동한다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> URL이 <code>/product/{productId}</code> 형태로 변경된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 상품의 자세한 정보가 전용 페이지에서 표시된다</li>
</ul>
<p><strong>상품 상세 페이지 기능</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 상품 이미지, 설명, 가격 등의 상세 정보가 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 전체 화면을 활용한 상세 정보 레이아웃이 제공된다</li>
</ul>
<p><strong>상품 상세 - 장바구니 담기</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 상품 상세 페이지에서 해당 상품을 장바구니에 추가할 수 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 페이지 내에서 수량을 선택하여 장바구니에 추가할 수 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 수량 증가/감소 버튼이 제공된다</li>
</ul>
<p><strong>관련 상품 기능</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 상품 상세 페이지에서 관련 상품들이 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 같은 카테고리(category2)의 다른 상품들이 관련 상품으로 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 관련 상품 클릭 시 해당 상품의 상세 페이지로 이동한다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 현재 보고 있는 상품은 관련 상품에서 제외된다</li>
</ul>
<p><strong>상품 상세 페이지 내 네비게이션</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 상품 상세에서 상품 목록으로 돌아가는 버튼이 제공된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 브레드크럼을 통해 카테고리별 상품 목록으로 이동할 수 있다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> SPA 방식으로 페이지 간 이동이 부드럽게 처리된다</li>
</ul>
<h4 id="사용자-피드백-시스템"><a class="anchor" aria-hidden="true" tabindex="-1" href="#사용자-피드백-시스템"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>사용자 피드백 시스템</h4>
<p><strong>토스트 메시지</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 장바구니 추가 시 성공 메시지가 토스트로 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 장바구니 삭제, 선택 삭제, 전체 삭제 시 알림 메시지가 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 토스트는 3초 후 자동으로 사라진다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 토스트에 닫기 버튼이 제공된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 토스트 타입별로 다른 스타일이 적용된다 (success, info, error)</li>
</ul>
<h3 id="심화과제"><a class="anchor" aria-hidden="true" tabindex="-1" href="#심화과제"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>심화과제</h3>
<h4 id="spa-네비게이션-및-url-관리"><a class="anchor" aria-hidden="true" tabindex="-1" href="#spa-네비게이션-및-url-관리"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>SPA 네비게이션 및 URL 관리</h4>
<p><strong>페이지 이동</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 어플리케이션 내의 모든 페이지 이동(뒤로가기/앞으로가기를 포함)은 하여 새로고침이 발생하지 않아야 한다.</li>
</ul>
<p><strong>상품 목록 - URL 쿼리 반영</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 검색어가 URL 쿼리 파라미터에 저장된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 카테고리 선택이 URL 쿼리 파라미터에 저장된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 상품 옵션이 URL 쿼리 파라미터에 저장된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 정렬 조건이 URL 쿼리 파라미터에 저장된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 조건 변경 시 URL이 자동으로 업데이트된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> URL을 통해 현재 검색/필터 상태를 공유할 수 있다</li>
</ul>
<p><strong>상품 목록 - 새로고침 시 상태 유지</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 새로고침 후 URL 쿼리에서 검색어가 복원된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 새로고침 후 URL 쿼리에서 카테고리가 복원된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 새로고침 후 URL 쿼리에서 옵션 설정이 복원된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 새로고침 후 URL 쿼리에서 정렬 조건이 복원된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 복원된 조건에 맞는 상품 데이터가 다시 로드된다</li>
</ul>
<p><strong>장바구니 - 새로고침 시 데이터 유지</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 장바구니 내용이 브라우저에 저장된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 새로고침 후에도 이전 장바구니 내용이 유지된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 장바구니의 선택 상태도 함께 유지된다</li>
</ul>
<p><strong>상품 상세 - URL에 ID 반영</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 상품 상세 페이지 이동 시 상품 ID가 URL 경로에 포함된다 (<code>/product/{productId}</code>)</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> URL로 직접 접근 시 해당 상품의 상세 페이지가 자동으로 로드된다</li>
</ul>
<p><strong>상품 상세 - 새로고침시 유지</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 새로고침 후에도 URL의 상품 ID를 읽어서 해당 상품 상세 페이지가 유지된다</li>
</ul>
<p><strong>404 페이지</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 존재하지 않는 경로 접근 시 404 에러 페이지가 표시된다</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 홈으로 돌아가기 버튼이 제공된다</li>
</ul>
<h4 id="ai로-한-번-더-구현하기"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ai로-한-번-더-구현하기"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>AI로 한 번 더 구현하기</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 기존에 구현한 기능을 AI로 다시 구현한다.</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 이 과정에서 직접 가공하는 것은 최대한 지양한다.</li>
</ul>
<h2 id="과제-셀프회고"><a class="anchor" aria-hidden="true" tabindex="-1" href="#과제-셀프회고"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>과제 셀프회고</h2>
<img width="388" height="306" alt="image" src="https://github.com/user-attachments/assets/107deb56-8fb0-4e1e-a0ee-a1023a1b6534"/>
ㅠㅁㅠ 
<!-- -->
<p>바닐라 자바스크립트를 할 줄 안다고 생각했는데 잘 모른다는 것을 깨달았다. 농담으로 &#x27;리액트 개발자&#x27;라는 말을 쓰기도 하는데 나는 리액트 개발자도 아니다. 뷰를 더 많이 썼기 때문이다. 그럼 뷰 개발자? 라기에도 뷰를 그렇게까지 깊이 아는 건 아니다. ㅜㅜ</p>
<ol>
<li>라우터 만들기
먼저 간단하게 라우터를 구현하기로 했다. 왜냐하면, GitHub Pages에 배포를 하면 라우터나 경로 문제가 생길 것이므로 이걸 먼저 해결해놓고 개발에 집중하는 게 편하기 때문이다. 처음에는 라우터에 대해 별다른 깊은 고민을 하지 않고 만들었다. routes 배열과 renderPage함수를 우선 만들어 렌더링이 되는 걸 확인하고 추가로 Router 함수를 붙였다. 즉시실행 함수를 이용한 싱글턴 패턴이다. 이 함수를 추가할 당시에는 아무 생각 없이 노션의 예제를 베이스로 만들었기 때문에 싱글턴까지 생각을 못 했다가 나중에 깨달았다.</li>
</ol>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">HomePage</span></span> <span class="token keyword module">from</span> <span class="token string">&quot;./pages/HomePage&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">DetailPage</span></span> <span class="token keyword module">from</span> <span class="token string">&quot;./pages/DetailPage&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">  <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token maybe-class-name">HomePage</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/detail&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token maybe-class-name">DetailPage</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token maybe-class-name">Router</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">let</span> currentPath <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">pathname</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function-variable function">getPath</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> currentPath<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token function-variable function">push</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>currentPath <span class="token operator">===</span> path<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
</span><span class="code-line">      currentPath <span class="token operator">=</span> path<span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">history</span><span class="token punctuation">.</span><span class="token method function property-access">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token function">renderPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> renderPage <span class="token operator">=</span> <span class="token punctuation">(</span>routerId <span class="token operator">=</span> <span class="token string">&quot;router-view&quot;</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">pathname</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> route <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> r<span class="token punctuation">.</span><span class="token property-access">path</span> <span class="token operator">===</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> routerRoot <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span>routerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>routerRoot<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    routerRoot<span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> route<span class="token punctuation">.</span><span class="token method function property-access">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">    routerRoot<span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token string">&quot;&lt;h1&gt;not found😂&lt;/h1&gt;&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">let</span> initialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initRouter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>initialized<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
</span><span class="code-line">  initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token function">renderPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// 뒤로가기</span>
</span><span class="code-line">  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;popstate&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">renderPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> target <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token property-access">dataset</span><span class="token punctuation">.</span><span class="token property-access">routerLink</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      router<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token property-access">dataset</span><span class="token punctuation">.</span><span class="token property-access">routerLink</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="import HomePage from &quot;./pages/HomePage&quot;;
import DetailPage from &quot;./pages/DetailPage&quot;;

const routes = [
  {
    path: &quot;/&quot;,
    component: HomePage,
  },
  {
    path: &quot;/detail&quot;,
    component: DetailPage,
  },
];

export const Router = (() =&gt; {
  let currentPath = window.location.pathname;

  return () =&gt; ({
    getPath: () =&gt; currentPath,
    push: (path) =&gt; {
      if (currentPath === path) return;
      currentPath = path;
      window.history.pushState({}, &quot;&quot;, path);
      renderPage();
    },
  });
})();

export const renderPage = (routerId = &quot;router-view&quot;) =&gt; {
  const path = window.location.pathname;
  const route = routes.find((r) =&gt; r.path === path);
  const routerRoot = document.getElementById(routerId);

  if (!routerRoot) return;

  if (route) {
    routerRoot.innerHTML = route.component();
  } else {
    routerRoot.innerHTML = &quot;&lt;h1&gt;not found😂&lt;/h1&gt;&quot;;
  }
};

let initialized = false;

export const initRouter = () =&gt; {
  if (initialized) return;
  initialized = true;

  const router = Router();

  renderPage();

  // 뒤로가기
  window.addEventListener(&quot;popstate&quot;, () =&gt; renderPage());

  document.addEventListener(&quot;click&quot;, (e) =&gt; {
    const { target } = e;
    if (target.dataset.routerLink) {
      router.push(target.dataset.routerLink);
    }
  });
};
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>SPA를 구현할 때 이벤트 위임 방식이 더 좋을 수 있다는 것도 이번 발제 때 처음 깨달았다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;router-view&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</span></code><div class="copied" data-code=" &lt;div id=&quot;router-view&quot;&gt;&lt;/div&gt;
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>템플릿 안에서 라우터 영역을 만들어준다. 처음에는 이것도 레이아웃 컴포넌트 안에서 엘리먼트를 찾아서 innerHTML안에 템플릿을 넣으려 했는다. 그러나... DOM에 아직 존재하지 않는 엘리먼트를 찾을 수 없다. 😳 순수하게 템플릿 문자열만 리턴하는 함수로 구성되어 있기 때문이다. 그래서 <code>queueMicrotask(() =&gt; {})</code>를 사용해서 한 틱 미룬 뒤에 엘리먼트를 찾은 후에 페이지를 렌더링 하는 시도를 했었다. 실행 타이밍이 정확히 언제인지 확신이 없어서 쓰지 않았다. 대신 <code>initRouter</code>로 main 함수 안에서 한번 초기화 하도록 했다.</p>
<ol start="2">
<li>배포
워크플로우를 추가하여 main에 푸쉬 하면 빌드하여 github-pages에 배포되도록 했다. 이렇게만 올리면.. 안 된다. 기본 경로(/front_7th_chapter2-1/)가 자동으로 붙기 때문에, Vite의 base 옵션을 해당 경로로 설정해주어야 한다.</li>
</ol>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token comment">// vite.config.js</span>
</span><span class="code-line"><span class="token literal-property property">base</span><span class="token operator">:</span> env<span class="token punctuation">.</span><span class="token constant">VITE_BASE_PATH</span> <span class="token operator">||</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
</span></code><div class="copied" data-code="// vite.config.js
base: env.VITE_BASE_PATH || &quot;/&quot;,
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>사실 환경변수를 굳이 추가하지 않아도 분기 처리는 가능하지만, 그냥 명시적으로 설정해두었다.</p>
<p>이렇게 하면 에셋의 경로는 잘 잡아주지만 라우터의 베이스도 다시 잡아야 한다. 라우터에서 BASE_PATH가 존재하면 잘 잘라내도록 설정을 해주어야 한다.</p>
<p>그렇게 하고 배포를 했을 때 잘 나올 줄 알았는데 아무것도 화면에 나오지 않았다. msw 경고는 무시하고 라우터 부터 보려고 했었는데, msw 설정에 실패하면 뒤의 함수가 실행되지 않게 되어있었다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token comment">// main.js</span>
</span><span class="code-line"><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">&quot;./mocks/browser.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> worker <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span>
</span><span class="code-line">    worker<span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token literal-property property">onUnhandledRequest</span><span class="token operator">:</span> <span class="token string">&quot;bypass&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token literal-property property">serviceWorker</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">VITE_BASE_PATH</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">mockServiceWorker.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span></code><div class="copied" data-code="// main.js
import(&quot;./mocks/browser.js&quot;).then(({ worker }) =&gt;
    worker.start({
      onUnhandledRequest: &quot;bypass&quot;,
      serviceWorker: {
        url: `${import.meta.env.VITE_BASE_PATH}mockServiceWorker.js`,
      },
    }),
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>이와 같이 수정한다. 기본적인 라우터가 작동되는 것을 확인할 수 있다.</p>
<p>그럼 이제 새로고침이 안 될 것을 예상할 수 있다. SPA라 페이지를 못 찾기 때문이다. github-pages는 이럴 경우 404.html로 폴백 처리 하는데 그냥 간단하게 해결했다.
package.json에서 빌드 후 index.html을 404.html으로 복사해준다.</p>
<pre class="language-json"><code class="language-json code-highlight"><span class="code-line"> <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite build &amp;&amp; cp dist/index.html dist/404.html&quot;</span><span class="token punctuation">,</span>
</span></code><div class="copied" data-code=" &quot;build&quot;: &quot;vite build &amp;&amp; cp dist/index.html dist/404.html&quot;,
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>여기까지 하면 배포 문제가 해결된다.</p>
<ol start="3">
<li>컴포넌트
가장 고민을 많이 한 부분이다.</li>
</ol>
<p>우선 컴포넌트를 함수와 클래스 중에 고민 했는데 요즘엔 함수형 프로그래밍을 선호하기도 하고 팀원의 함수형을 지향한다는 의견을 따라서 아무 생각 없이 함수형 컴포넌트로 시작을 했다. 함수형 프로그래밍이 객체지향과 비교했을 때 어떤 이점이 있는 걸까? 하는 의문이 들었다. 아무래도 그래도 객체지향이 조금 더 익숙하기 때문이다. 그 부분에 대해 멘토링 시간에 질문을 했다. 결론을 요약하면 취향 차이라고 한다.</p>
<p>단순하게 문자열을 리턴하는 함수형 컴포넌트를 사용하면 컴포넌트 내에서 비동기 작업을 할 수 없고, 단순한 프레젠테이션 컴포넌트에 가깝다. 따라서 컴포넌트 안에 render 와 같은 함수가 필요했고 그러려면 부모를 기반으로 렌더링을 해야 한다.</p>
<p>컴포넌트 안에서 컨테이너를 만들고 아이디를 고정하여 리렌더링하는 방식도 시도해 보았지만 이 방식도 렌더링 시점을 정확히 파악하기 어려운 것 같아서 폐기했다. 유니크한 ID를 만들어볼까도 했지만 이 단계에서는 최대한 간단한 구조로 먼저 구현하는 게 나을 거라 판단했다.</p>
<p>이러한 렌더 함수가 있는 컴포넌트는 데이터를 fetch하는 페이지 단위에서만 우선 적용하면 될 것 같아 일단 페이지 안에서 작업을 했다. 그리고 라우터 초기화 시점에서 받은 라우터 컨테이너의 id를, renderPage 함수에서 에서 항상 전달하면 된다.</p>
<pre><code class="code-highlight"><span class="code-line">// router.js
</span><span class="code-line"> ...
</span><span class="code-line">    route.component({
</span><span class="code-line">      root: routerRoot,
</span><span class="code-line">    });
</span><span class="code-line">...
</span></code><div class="copied" data-code="// router.js
 ...
    route.component({
      root: routerRoot,
    });
...
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token spread operator">...</span>
</span><span class="code-line"><span class="token comment">// 페이지 내</span>
</span><span class="code-line">  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/api/products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword control-flow">await</span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  products <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token property-access">products</span><span class="token punctuation">;</span>
</span><span class="code-line">  pagination <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token property-access">pagination</span><span class="token punctuation">;</span>
</span><span class="code-line">  isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token spread operator">...</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="...
// 페이지 내
  render();

  const response = await fetch(&quot;/api/products&quot;);
  const data = await response.json();
  products = data.products;
  pagination = data.pagination;
  isLoading = false;

...

  render();
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>이렇게 하면 상태 관리도 귀찮고 이벤트 바인딩을 하면 항상 초기화 된다. 어느 정도 공통화를 하고 싶었다.
하지만 생명 주기를 어떻게 관리해야 할지는 고민이 되었다. 우선 넘어가서 상세 페이지 작업을 마저 했다. 그 뒤 AI의 도움을 (많이) 받았다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token string">&#x27;...&#x27;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">     root<span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> template<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="export const createPage = (root) =&gt; {
  let state = {};
  const template = &#x27;...&#x27;

  const render = () =&gt; {
     root.innerHTML = template;
  }
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>나는 이 정도로 작성한 뒤에 AI로 개선했다.</p>
<p>전부 객체로 리턴시키는 식으로 컴포넌트를 작성할 수도 있었는데, 모양이 vue의 options api와 비슷해졌다. 나는 별로 좋아하지 않는 방식이고 훅을 사용하고 싶었기에 몇 번 질의를 하여 컴포넌트의 초안은 이렇게 잡았다. (이후에도 여러 번 수정을 했다.)</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> setup</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">let</span> <span class="token function-variable function">view</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> binders <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">let</span> cleanups <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">getState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token spread operator">...</span>state <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">patch</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    state <span class="token operator">=</span> <span class="token keyword">typeof</span> patch <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">?</span> <span class="token function">patch</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>state<span class="token punctuation">,</span> <span class="token spread operator">...</span>patch <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">template</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    view <span class="token operator">=</span> fn<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">afterRender</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;afterRender&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    binders<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// 이전 바인딩 제거</span>
</span><span class="code-line">    cleanups<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    cleanups <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// 그리기</span>
</span><span class="code-line">    root<span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token function">view</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// 새 바인딩</span>
</span><span class="code-line">    binders<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> root<span class="token punctuation">,</span> getState<span class="token punctuation">,</span> setState <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> c <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> cleanups<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> getState<span class="token punctuation">,</span> setState<span class="token punctuation">,</span> template<span class="token punctuation">,</span> afterRender <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;unmount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      cleanups<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      cleanups <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">      root<span class="token punctuation">.</span><span class="token method function property-access">replaceChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="export const createPage = (root, setup) =&gt; {
  let state = {};
  let view = () =&gt; &quot;&quot;;
  const binders = [];
  let cleanups = [];

  const getState = () =&gt; ({ ...state });
  const setState = (patch) =&gt; {
    state = typeof patch === &quot;function&quot; ? patch(state) : { ...state, ...patch };
    render();
  };

  const template = (fn) =&gt; {
    view = fn;
  };
  const afterRender = (fn) =&gt; {
    console.log(&quot;afterRender&quot;);
    binders.push(fn);
  };

  const render = () =&gt; {
    // 이전 바인딩 제거
    cleanups.forEach((fn) =&gt; fn &amp;&amp; fn());
    cleanups = [];

    // 그리기
    root.innerHTML = view(state);

    // 새 바인딩
    binders.forEach((fn) =&gt; {
      const c = fn({ root, getState, setState });
      if (typeof c === &quot;function&quot;) cleanups.push(c);
    });
  };

  setup({ getState, setState, template, afterRender });
  render();

  return {
    unmount() {
      console.log(&quot;unmount&quot;);
      cleanups.forEach((fn) =&gt; fn &amp;&amp; fn());
      cleanups = [];
      root.replaceChildren();
    },
  };
};
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>페이지 위주로 컴포넌트를 작업하고 단순히 뷰만 가지고 있는 컴포넌트는 순수 템플릿 함수를 유지하기로 했다.</p>
<ol start="4">
<li>이벤트 버스
라우터 영역에서 페이지 단위로 컴포넌트를 만들어놨는데 헤더도 동적으로 변경되는 내용이 있었다. 대충 처음엔 라우터 안에서 헤더를 업데이트했다가 그러면 컴포넌트를 나눈 의미가 없는 것 같았다. 그래서 라우터의 개선이 필요했다. 단순히 라우터가 컴포넌트를 렌더링하고 끝나는 게 아니라, 컴포넌트 내부에서 라우트의 변화를 감지 할 수 있어야 한다. 어떤 방식으로 할 수 있을까 하다가, 처음엔 커스텀 이벤트를 만들어서 핑퐁하려 했다. 그러면서 장바구니도 다 이벤트로 처리했다. 이렇게 목록, 상세, 카트 추가를 기능 구현만 완료했다.</li>
</ol>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line">  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">&quot;route:changed&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">detail</span><span class="token operator">:</span> <span class="token punctuation">{</span> path <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">&quot;cart:add&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">detail</span><span class="token operator">:</span> <span class="token punctuation">{</span> productId<span class="token punctuation">,</span> <span class="token literal-property property">quantity</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">quantity</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="  window.dispatchEvent(new CustomEvent(&quot;route:changed&quot;, { detail: { path } }));
 window.dispatchEvent(new CustomEvent(&quot;cart:add&quot;, { detail: { productId, quantity: state.quantity } }));
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>그런데 이러면 유지보수도 힘들 거 같고 쓸 때마다 이벤트 리스너를 추가해야 할 수도 있고 어디에 이벤트 리스너 추가했는지 까먹을 수 있어서 메모리 누수도 발생할 수 있을 것 같다.</p>
<p>노션의 지식 뭉치를 읽어다가 옵저버 패턴이 있었고, 옵저버 패턴을 GPT에게 물어보다가 <code>이벤트 버스</code>를 사용하라는 방식을 들었다. 그래서 구현해달라고 했다. 😄<br/>
<a href="https://github.com/milmilkim/front_7th_chapter2-1/commit/b6b2bfa492284708e03ca954f4d21c13bc4e07ff">https://github.com/milmilkim/front_7th_chapter2-1/commit/b6b2bfa492284708e03ca954f4d21c13bc4e07ff</a>
싱글턴 클래스는 아니지만 <code>모듈 캐시에 의한 싱글턴</code>이다.
라우터가 즉시 실행 함수로 구현된 싱글턴이라면,이벤트 버스는 new EventBus()를 한 번만 생성해서 export하기 때문에 모든 모듈이 동일한 인스턴스를 공유하는 형태의 싱글턴이 된다.</p>
<p>그러다보니 무한 루프에 걸렸다. 스테이트가 변경될 때마다 렌더를 했고 렌더 안에서 이벤트 등록을 했기 때문이다.
상태 변경 → 렌더 → 렌더 안에서 이벤트 on → emit → 다시 상태 변경 → 다시 렌더…<br/>
이 패턴이 반복되면서 구독이 렌더 횟수만큼 중첩되고, 결국 무한 루프가 발생했다.</p>
<p>해서 render()함수와 별도로 onMount, onUpdated, (onUnmount)를 추가했다. 어쩌다보니 Vue를 따라하고 있었다. 그리고 최대한 간단하게 가려 했지만 라이프 사이클에 대해 고민하느라 머리가 아파지기 시작했다.</p>
<ol start="5">
<li>
<p>옵저버 패턴 상태 관리
<a href="https://github.com/milmilkim/front_7th_chapter2-1/blob/7b2607733a732734fb2d9f9ea9532821e5acfef8/src/stores/cartStore.js">https://github.com/milmilkim/front_7th_chapter2-1/blob/7b2607733a732734fb2d9f9ea9532821e5acfef8/src/stores/cartStore.js</a>
장바구니의 경우 옵저버 패턴으로 상태를 관리할 수 있도록 했다. 노션 내용을 참고하여 구현은 AI에게 맡겼다.
cartStore 뿐 아니라 다른 Store도 추가될 수 있도록 처음엔 베이스 클래스를 추상화 하려 했지만, 함수형으로 만드려는 처음의 생각이 있었기에 함수로 바꾸었다. 최근 나는 zustand를 썼기 때문에 그런 모양으로 만들었다.</p>
</li>
<li>
<p>리팩토링
<a href="https://github.com/milmilkim/front_7th_chapter2-1/commit/f4ee764ca73ee638d746b37b317307ea30bea8b2">https://github.com/milmilkim/front_7th_chapter2-1/commit/f4ee764ca73ee638d746b37b317307ea30bea8b2</a>
불필요하다고 생각되는 부분을 정리하고 컴포넌트 형식을 바꾸고 useAsync 훅을 만드는 시도를 했었다.
그런데 useAsync를 쓰려면 또 구독을 해야 하고 더 복잡한 거 같아서 이것은 일단 없애고, 기능 구현을 마저 하기로 했다.</p>
</li>
<li>
<p>무한 스크롤
<code>intersection observer</code> API를 통해 구현한다.</p>
</li>
</ol>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"> <span class="token comment">// 무한 스크롤 옵저버 생성</span>
</span><span class="code-line">    observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      entries<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">isIntersecting</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;무한 스크롤 옵저버 트리거&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">          <span class="token keyword">const</span> <span class="token punctuation">{</span> isLoading<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">          <span class="token keyword">const</span> pagination <span class="token operator">=</span> data<span class="token operator">?.</span>pagination <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">          <span class="token comment">// 로딩 중이거나 더 이상 데이터가 없으면 요청하지 않음</span>
</span><span class="code-line">          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
</span><span class="code-line">          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pagination<span class="token punctuation">.</span><span class="token property-access">hasNext</span><span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">          <span class="token comment">// 다음 페이지 로드</span>
</span><span class="code-line">          <span class="token keyword">const</span> <span class="token punctuation">{</span> filter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">filter</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>filter<span class="token punctuation">,</span> <span class="token literal-property property">page</span><span class="token operator">:</span> filter<span class="token punctuation">.</span><span class="token property-access">page</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">          <span class="token function">fetchProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code=" // 무한 스크롤 옵저버 생성
    observer = new IntersectionObserver((entries) =&gt; {
      entries.forEach((entry) =&gt; {
        if (entry.isIntersecting) {
          console.log(&quot;무한 스크롤 옵저버 트리거&quot;);
          const { isLoading, data } = getState();
          const pagination = data?.pagination || {};

          // 로딩 중이거나 더 이상 데이터가 없으면 요청하지 않음
          if (isLoading) return;
          if (!pagination.hasNext) return;

          // 다음 페이지 로드
          const { filter } = getState();
          setState({ filter: { ...filter, page: filter.page + 1 } });
          fetchProducts();
        }
      });
    });
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>잘 안 된다! isLoading이 true일 때 그대로 끝나서 아무 일도 일어나지 않았던 것이다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line">  <span class="token comment">// 매 렌더링마다 - sentinel 다시 관찰</span>
</span><span class="code-line">  <span class="token function">onUpdated</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>observer<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> sentinel <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#sentinel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>sentinel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      observer<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span>sentinel<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="  // 매 렌더링마다 - sentinel 다시 관찰
  onUpdated(() =&gt; {
    if (!observer) return;

    const sentinel = document.querySelector(&quot;#sentinel&quot;);
    if (sentinel) {
      observer.observe(sentinel);
    }
  });
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>onUpdated마다 다시 확인하도록 했다.</p>
<ol start="8">
<li>
<p>모달
모달의 경우 이벤트 버스를 사용한다. 구독중인 장바구니 모달이 이벤트를 받으면 상태를 변경한다. 모달 자체는 컴포넌트이며 스토어의 값을 사용한다. 스토어는 로컬스토리지에서 값을 초기화하고 업데이트 한다.</p>
</li>
<li>
<p>쿼리스트링
앞에서 라우터 이벤트를 다 만들어 놓았기에 이벤트를 구독하고 거기에 맞춰 검색 필터의 값을 넣어준다. 초반에 만든 라우터에서 계속 분기를 추가하여 만들었는데, 지저분해졌다. 그래서 나중에 정리하기로 했다.</p>
</li>
<li>
<p>리팩토링
여기까지 하면 CI에 초록불이 들어온다. E2E 테스트를 통과한다. 하지만 우선 구현을 한다가 목표였기에 제대로 검수하지 않았기 때문에 이제 테스트가 깨지지 않는 상태를 유지하며 리팩토링 진행한다. 이 과정에서 e2e 테스트의 소중함을 느낄 수 있다. 테스트 코드가 존재하기 때문에 맘 놓고 이것저것 테스트 해볼 수 있다. 하지만 이미 작성된 E2E 테스트만으로는 잡히지 않는 문제가 있을 수 있기 때문에 눈으로도 봐가며 진행했다.</p>
</li>
</ol>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line">   <span class="token comment">// 장바구니 Store 구독</span>
</span><span class="code-line">    unsubscribe <span class="token operator">=</span> cartStore<span class="token punctuation">.</span><span class="token method function property-access">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cartState</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">items</span><span class="token operator">:</span> cartState<span class="token punctuation">.</span><span class="token property-access">items</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token literal-property property">selectedItems</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module">from</span><span class="token punctuation">(</span>cartState<span class="token punctuation">.</span><span class="token property-access">items</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token property-access">selected</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="   // 장바구니 Store 구독
    unsubscribe = cartStore.subscribe((cartState) =&gt; {
      setState({
        items: cartState.items || [],
        selectedItems: new Set(Array.from(cartState.items.filter((item) =&gt; item.selected)).map((item) =&gt; item.id)),
      });
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>우선 이미 개발된 부분의 스토어 구독 부분을 살펴본다. cartStore를 구독하여 상태가 변경되면 setState를 호출하여 state의 값을 바꾸고 그래서 컴포넌트가 업데이트된다. 좀 별로인 것 같았다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"> <span class="token keyword">const</span> <span class="token function-variable function">useStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token method function property-access">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment">// 스토어 변경 시 리렌더 트리거</span>
</span><span class="code-line">        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      mountCleanups<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>unsubscribe<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code=" const useStore = (store) =&gt; {
      const unsubscribe = store.subscribe(() =&gt; {
        // 스토어 변경 시 리렌더 트리거
        render();
      });

      mountCleanups.push(unsubscribe);
    };
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>컴포넌트 셋업 함수에 useStore를 추가하여 스토어 변경시 컴포넌트가 업데이트하도록 했다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line">   <span class="token keyword">const</span> items <span class="token operator">=</span> cartStore<span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">items</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="   const items = cartStore.getState().items;
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>그리고 컴포넌트를 마운트 하는 방식이 통일되어야 했다. 기존엔 컴포넌트 팩토리 함수를 호출하면 바로 render()함수를 실행했는데 이러면 언제 렌더링을 하겠다는 건지 알기 어렵다. 또, 부모 컴포넌트 안에 자식 컴포넌트가 있을 경우 부모 컴포넌트의 DOM이 렌더링 된 시점에서 루트를 찾아야 자식 컴포넌트를 렌더링 할 수 있으므로 이 컴포넌트의 뷰가 한번 마운트 된 시점을 알 필요가 있다. 그래서 onMounted를 추가했다. onMount는 삭제하고 onBeforeMount를 추가했다. render함수는 리턴했다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">setup</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> root<span class="token punctuation">,</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token function-variable function">view</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token doc-comment comment">/**
</span></span><span class="code-line"><span class="token doc-comment comment">     * lifecycle callbacks
</span></span><span class="code-line"><span class="token doc-comment comment">     */</span>
</span><span class="code-line">    <span class="token keyword">const</span> beforeMountCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">const</span> mountedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">const</span> updatedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">const</span> unmountCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> isMounted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> mountedCleanups <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">getState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token spread operator">...</span>state <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">patch</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      state <span class="token operator">=</span> <span class="token keyword">typeof</span> patch <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">?</span> <span class="token function">patch</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>state<span class="token punctuation">,</span> <span class="token spread operator">...</span>patch <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">template</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      view <span class="token operator">=</span> fn<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// DOM 이벤트 헬퍼 (자동 cleanup)</span>
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">on</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> event<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>target<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
</span><span class="code-line">      target<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      unmountCallbacks<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> target<span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">onBeforeMount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      beforeMountCallbacks<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">onMounted</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      mountedCallbacks<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">onUpdated</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      updatedCallbacks<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">onUnmount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      unmountCallbacks<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// 스토어 구독 헬퍼 - subscribe만 처리</span>
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">useStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token method function property-access">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      mountedCleanups<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>unsubscribe<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      root<span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token function">view</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token comment">// 최초 렌더링일 경우 실행</span>
</span><span class="code-line">      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">✅ onMounted: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token operator">?.</span>name <span class="token operator">||</span> <span class="token string">&quot;component&quot;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        mountedCallbacks<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        isMounted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">      updatedCallbacks<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> root<span class="token punctuation">,</span> props<span class="token punctuation">,</span> getState<span class="token punctuation">,</span> setState<span class="token punctuation">,</span> template<span class="token punctuation">,</span> onBeforeMount<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmount<span class="token punctuation">,</span> onUpdated<span class="token punctuation">,</span> on<span class="token punctuation">,</span> useStore <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    beforeMountCallbacks<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token function-variable function">unmount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">🧨 unmount: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token operator">?.</span>name <span class="token operator">||</span> <span class="token string">&quot;component&quot;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      unmountCallbacks<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      mountedCleanups<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      root<span class="token punctuation">.</span><span class="token method function property-access">replaceChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      unmountCallbacks<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">      mountedCleanups<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">      getState<span class="token punctuation">,</span>
</span><span class="code-line">      setState<span class="token punctuation">,</span>
</span><span class="code-line">      unmount<span class="token punctuation">,</span>
</span><span class="code-line">      render<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span></code><div class="copied" data-code="export const createComponent = (setup) =&gt; {
  return ({ root, props = {}, options }) =&gt; {
    let state = {};
    let view = () =&gt; &quot;&quot;;

    /**
     * lifecycle callbacks
     */
    const beforeMountCallbacks = [];
    const mountedCallbacks = [];
    const updatedCallbacks = [];
    const unmountCallbacks = [];

    let isMounted = false;

    const mountedCleanups = [];

    const getState = () =&gt; ({ ...state });
    const setState = (patch) =&gt; {
      state = typeof patch === &quot;function&quot; ? patch(state) : { ...state, ...patch };
      render();
    };

    const template = (fn) =&gt; {
      view = fn;
    };

    // DOM 이벤트 헬퍼 (자동 cleanup)
    const on = (target, event, handler) =&gt; {
      if (!target) return;
      target.addEventListener(event, handler);
      unmountCallbacks.push(() =&gt; target.removeEventListener(event, handler));
    };

    const onBeforeMount = (fn) =&gt; {
      beforeMountCallbacks.push(fn);
    };

    const onMounted = (fn) =&gt; {
      mountedCallbacks.push(fn);
    };

    const onUpdated = (fn) =&gt; {
      updatedCallbacks.push(fn);
    };

    const onUnmount = (fn) =&gt; {
      unmountCallbacks.push(fn);
    };

    // 스토어 구독 헬퍼 - subscribe만 처리
    const useStore = (store) =&gt; {
      const unsubscribe = store.subscribe(() =&gt; {
        render();
      });

      mountedCleanups.push(unsubscribe);
    };

    const render = () =&gt; {
      root.innerHTML = view(state);

      // 최초 렌더링일 경우 실행
      if (!isMounted) {
        console.log(`✅ onMounted: ${options?.name || &quot;component&quot;}`);
        mountedCallbacks.forEach((fn) =&gt; fn &amp;&amp; fn());
        isMounted = true;
      }

      updatedCallbacks.forEach((fn) =&gt; {
        fn();
      });
    };

    setup({ root, props, getState, setState, template, onBeforeMount, onMounted, onUnmount, onUpdated, on, useStore });

    beforeMountCallbacks.forEach((fn) =&gt; {
      fn();
    });

    const unmount = () =&gt; {
      console.log(`🧨 unmount: ${options?.name || &quot;component&quot;}`);
      unmountCallbacks.forEach((fn) =&gt; fn());
      mountedCleanups.forEach((fn) =&gt; fn());

      root.replaceChildren();

      unmountCallbacks.length = 0;
      mountedCleanups.length = 0;
    };

    return {
      getState,
      setState,
      unmount,
      render,
    };
  };
};

"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>컴포넌트의 언마운트는... 우선 라우터에서 페이지가 바뀔 때는 언마운트를 시킨다.
이외의 경우에는 수동으로 언마운트를 해주어야 한다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">App</span> <span class="token operator">=</span> <span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> template<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmount <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function">template</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token comment">/*html*/</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div id=&quot;main-layout&quot;&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">let</span> mainLayout <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    mainLayout <span class="token operator">=</span> <span class="token function"><span class="token maybe-class-name">MainLayout</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;main-layout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;mainLayout&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    mainLayout<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token function">onUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    mainLayout<span class="token operator">?.</span><span class="token method function property-access">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="const App = createComponent(({ template, onMounted, onUnmount }) =&gt; {
  template(() =&gt; /*html*/ `&lt;div id=&quot;main-layout&quot;&gt;&lt;/div&gt;`);

  let mainLayout = null;
  onMounted(() =&gt; {
    mainLayout = MainLayout({ root: document.getElementById(&quot;main-layout&quot;), options: { name: &quot;mainLayout&quot; } });
    mainLayout.render();
  });

  onUnmount(() =&gt; {
    mainLayout?.unmount();
  });
});
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>이런 식으로 컴포넌트를 쌓으려 했는데, 부모 컴포넌트 안에 여러 개의 자식 컴포넌트가 있을 때는 어떻게 처리해야 할지 고민이 되었다. 그럼 자식 컴포넌트의 인스턴스를 부모가 다 가지고 있어야 하고 상태도 복원해야 하겠고 모조리 다 리렌더링 되어서 성능도 별로일 것 같다.</p>
<p>그정도까진 고민하지 않아도 되겠지? 하는 마음을 가지고 있었는데 다음주의 과제가 그런 쪽의 알고리즘 구현이라고 하니... 다음주에 더 깊게 고민하기로 했다.</p>
<ol start="11">
<li>라우터 구조 변경
돌아가게는 만들어 놓고 Q&amp;A 세션에서 라우터에 대한 부분을 보며 아차 하는 생각이 들었다. 또한 이벤트 버스도 전역적이라는 것에서 본질은 똑같았다. 어차피 정리도 해야 했으므로 기존 내용을 옵저버 패턴으로 변경하였다. 그랬더니 전체적으로 여기저기 수정해야 했고 리팩토링 하면서 e2e테스트가 여러 번 깨졌다.</li>
</ol>
<p><a href="https://github.com/milmilkim/front_7th_chapter2-1/commit/24154381773932e2ac3fe7c141a2657832112b4b#diff-3210ca9ed615e6f0fc1743fc09be3c86bc38178dcc050e5a41ff7982d15875b7">https://github.com/milmilkim/front_7th_chapter2-1/commit/24154381773932e2ac3fe7c141a2657832112b4b#diff-3210ca9ed615e6f0fc1743fc09be3c86bc38178dcc050e5a41ff7982d15875b7</a>
새 페이지를 렌더링 할 때 이전 페이지를 언마운트 하는 게 누락되어서 페이지가 언마운트 되지 않고 이벤트 리스너를 삭제하지 않아 여러 이벤트가 중첩되는 문제가 있어서 수정하였다.
그리고 상품 목록도 쿼리 스트링 기반으로 모두 처리하게 변경했다.</p>
<h3 id="기술적-성장"><a class="anchor" aria-hidden="true" tabindex="-1" href="#기술적-성장"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>기술적 성장</h3>
<!-- -->
<p>설계의 중요성을 느끼게 되었다. 그리고 AI를 이전보다 좀 더 잘 다루게 된 것 같다.</p>
<h3 id="자랑하고-싶은-코드"><a class="anchor" aria-hidden="true" tabindex="-1" href="#자랑하고-싶은-코드"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>자랑하고 싶은 코드</h3>
<!-- -->
<p>클로저 기반의 라이프 사이클을 가지고 있는 컴포넌트의 구현을 시도했다. 고민 자체에 의의가 있다는 생각이 든다.
전체적으로 함수형 프로그래밍을 유지해보려는 노력을 했다.
컴포넌트 내에 헬퍼 함수를 통해 이벤트를 추가하면 자동으로 컴포넌트가 언마운트 되는 시점에 해제되도록 했다.</p>
<h3 id="개선이-필요하다고-생각하는-코드"><a class="anchor" aria-hidden="true" tabindex="-1" href="#개선이-필요하다고-생각하는-코드"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>개선이 필요하다고 생각하는 코드</h3>
<!-- -->
<p>부모가 여러 자식 컴포넌트를 가지고 있는 구조는 구현하지 못했다. 렌더링시 innerHTML의 모든 내용을 교체하는 방식은 성능에 한계가 있다.
전체를 렌더링 하기 때문에 input의 포커스가 날아가거나 모바일에서 이미지가 깜빡이는 등의 문제가 있었다. 라이프사이클은 뷰를 모방했지만 불안정하다. 수동적으로 언마운트를 해야 한다. 전역 스토어에서 바뀐 것만 부분적으로 구독하는 식으로 최적화를 하지 못했다.</p>
<h3 id="학습-효과-분석"><a class="anchor" aria-hidden="true" tabindex="-1" href="#학습-효과-분석"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>학습 효과 분석</h3>
<!-- -->
<p>이전에 클로저를 사용 자체는 많이 해보았지만 좀 더 깊이 있게 이해하게 되었다. 옵저버와 같은 디자인 패턴은 사실 전혀 몰랐던 부분이어서 새로운 걸 알게 되어 좋았다. 막연하게 생각하던 생명주기, 훅, 클린업 함수에 대해서도 어떤 맥락인지 이해하게 된 것 같다. (어쩐지 리액트보다는 뷰에 대한 이해가 더 잘 된 것 같긴하다.)</p>
<p>리액트를 사용하면 선언적 프로그래밍을 지향하게 되는데... 그런데 정말 선언적이라는 게 뭔가? 하는 생각이 있었는데 명령형 방식과 비교해보고 멘토링 시간에 설명을 듣다 보니 이제 좀 알 것 같은 기분이다.</p>
<h3 id="과제-피드백"><a class="anchor" aria-hidden="true" tabindex="-1" href="#과제-피드백"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>과제 피드백</h3>
<!-- -->
<p>몇가지 예시는 있지만 어떤 방향과 목적을 가지고 작업해야 하는지는 스스로 찾아가야 한다는 점이 재미있었다. 높은 자유도에 처음에는 막막했지만 코어 근육을 단련한 것 같다.</p>
<h3 id="ai-활용-경험-공유하기"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ai-활용-경험-공유하기"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>AI 활용 경험 공유하기</h3>
<!-- -->
<ul>
<li>
<p>설계에 대한 질문 하기
render(), update() 등의 생명 주기를 가지고 있는 컴포넌트를 구현할 수 있는 아이디어에 대해 요청한 후 코드를 살펴본다. setup 함수를 가지고 있는 클로저로 컴포넌트를 만들고 되도록 선언적으로 만들고 싶다고 했다. 마음에 드는 결과가 나올 때까지 초기화하고 질문을 바꿔본다. 이번 과제는 AI가 프로젝트의 콘텍스트를 다 알 필요는 없다고 생각하고 토큰도 없어서 컴포넌트에 대한 부분은 chatGPT에 거의 맡겼다.</p>
</li>
<li>
<p>단순 작업을 위임하기
어느 정도 설계가 갖춰진 후에는 누가 해도 결과가 비슷할 단순한 장바구니 같은 작업은 cursor에 맡긴 후 검수하고 버그를 수정한다. 라우터의 이런 저런 예외 케이스나 정규식 같은 부분도 AI에게 구현을 맡긴다.</p>
</li>
<li>
<p>리팩토링 하기
라우터나 컴포넌트의 설계를 변경하였을 때 연동된 기능들에 대한 리팩토링을 AI에게 시킨 후 변경 내역을 확인한다. 분석하고 다시 내가 마음에 드는 방향으로 정리한다. 이 부분은 커서와, 저번 과제 하느라 결제한 클로드 코드를 활용했다.</p>
</li>
</ul>
<h2 id="리뷰-받고-싶은-내용"><a class="anchor" aria-hidden="true" tabindex="-1" href="#리뷰-받고-싶은-내용"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>리뷰 받고 싶은 내용</h2>
<ol>
<li><code>render()</code> 함수에서 <code>isMounted</code> 체크를 통해 최초 렌더링과 업데이트를 구분하는 방식이 적절할까요?</li>
<li><code>useStore</code> 훅에서 구독만 하고 상태를 직접 읽지 않는 구조입니다. 제공하는 훅이 값까지 함께 리턴하는 형태가 좋은지, 아니면 지금처럼 구독만 하고 UI에서 getState로 직접 읽는 패턴도 괜찮은지 궁금합니다.</li>
<li>인풋 이벤트나 체인지 이벤트가 발생할 때마다 렌더링을 시키면 인풋에서 포커스 아웃이 되기 때문에 uncontrolled 방식을 사용하였습니다. 이 경우 인풋의 값을 변경해놓고 다른 필터를 변경하여 다른 필터 값 변경 시 인풋 값이 날아가는 문제가 있는데 개선 방법이 있을까요?</li>
<li>컴포넌트 안에 컴포넌트가 여러 개 존재하는데 마운트/언마운트를 제어하는 방법은 무엇일까요? 전역적으로 컴포넌트를 등록하고 관리해야 할까요?</li>
</ol>
</div></div><div class="overflow-auto mt-9"><div data-color-mode="dark" class="wmde-markdown wmde-markdown-color p-6 max-w-full" style="word-wrap:break-word;overflow-wrap:break-word"><h2 id="과제-피드백"><a class="anchor" aria-hidden="true" tabindex="-1" href="#과제-피드백"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>과제 피드백</h2>
<p>안녕하세요 소리님! 4주차 과제 쉽지 않았을텐데 잘 진행해주셨네요 ㅎㅎ 고생하셨습니다!</p>
<blockquote>
<p>render() 함수에서 isMounted 체크를 통해 최초 렌더링과 업데이트를 구분하는 방식이 적절할까요?</p>
</blockquote>
<p>잘 진행해주셨다고 생각합니다 ㅎㅎ
지금 코드에서 다른 방법은... 딱히 생각나질 않네요 ㅋㅋ</p>
<p>조금 다른 방법으로는, 리액트에서는 render 함수를 실행한 다음에 queueMicrotask 같은 api를 사용해서 mount 된 시점을 &quot;예측&quot; 하는 걸로 알고 있어요.</p>
<p>다만 지금 소리님께서 만드신 방식은 어차피 innerHTML 로 dom을 직접 렌더링 하고 있기 때문에 그럴 필요가 없는 상태랍니다!</p>
<blockquote>
<p>useStore 훅에서 구독만 하고 상태를 직접 읽지 않는 구조입니다. 제공하는 훅이 값까지 함께 리턴하는 형태가 좋은지, 아니면 지금처럼 구독만 하고 UI에서 getState로 직접 읽는 패턴도 괜찮은지 궁금합니다.</p>
</blockquote>
<p>지금과 같은 방식도 나쁘지 않다고 생각해요 ㅎㅎ
물론 useStore에서 필요한 값을 selector를 통해 가져와서 사용하는 방식도 있을 것 같아요!</p>
<blockquote>
<p>인풋 이벤트나 체인지 이벤트가 발생할 때마다 렌더링을 시키면 인풋에서 포커스 아웃이 되기 때문에 uncontrolled 방식을 사용하였습니다. 이 경우 인풋의 값을 변경해놓고 다른 필터를 변경하여 다른 필터 값 변경 시 인풋 값이 날아가는 문제가 있는데 개선 방법이 있을까요?</p>
</blockquote>
<p>지금 상황에서는 어쩔 수 없다고 생각해요. 이를 개선하려면 render 시스템 자체를 재구성해야 하는데, 그러면 일이 무척 커지니까요 ㅎㅎ
이를 해결하기 위한 과정이 5주차 과제라고 보시면 될 것 같습니다!</p>
<blockquote>
<p>컴포넌트 안에 컴포넌트가 여러 개 존재하는데 마운트/언마운트를 제어하는 방법은 무엇일까요? 전역적으로 컴포넌트를 등록하고 관리해야 할까요?</p>
</blockquote>
<p>마찬가지로 5주차 과제를 하면서 고민해보시면 좋을 것 같아요!</p>
<p>--</p>
<p>고생하셨습니다 소리님!</p></div></div><div class="mt-9"></div></div></main></div></div></div>
    <title>[6팀 김소리] Chapter2-1. 프레임워크 없이 SPA 만들기  - 김소리 | 항해플러스 프론트엔드 7기</title>
    <meta name="description" content=" [항해플러스 프론트엔드 7기] 김소리님이 제출한 [6팀 김소리] Chapter2-1. 프레임워크 없이 SPA 만들기  과제를 확인하세요. 코드 구현, 문제 해결 과정, 피드백 내용을 상세히 살펴볼 수 있습니다." />
    <meta name="keywords" content="항해플러스, 프론트엔드, 개발자교육, React, TypeScript, JavaScript, 기술면접, 웹개발, 김소리, [6팀 김소리] Chapter2-1. 프레임워크 없이 SPA 만들기 , 과제상세, 코드리뷰, 피드백, Pull Request" />
    <meta property="og:title" content="[6팀 김소리] Chapter2-1. 프레임워크 없이 SPA 만들기  - 김소리 | 항해플러스 프론트엔드 7기" />
    <meta property="og:description" content=" [항해플러스 프론트엔드 7기] 김소리님이 제출한 [6팀 김소리] Chapter2-1. 프레임워크 없이 SPA 만들기  과제를 확인하세요. 코드 구현, 문제 해결 과정, 피드백 내용을 상세히 살펴볼 수 있습니다." />
    <meta property="og:image" content="/defaultThumbnail.jpg" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="[6팀 김소리] Chapter2-1. 프레임워크 없이 SPA 만들기  - 김소리 | 항해플러스 프론트엔드 7기" />
    <meta name="twitter:description" content=" [항해플러스 프론트엔드 7기] 김소리님이 제출한 [6팀 김소리] Chapter2-1. 프레임워크 없이 SPA 만들기  과제를 확인하세요. 코드 구현, 문제 해결 과정, 피드백 내용을 상세히 살펴볼 수 있습니다." />
    <meta name="twitter:image" content="/defaultThumbnail.jpg" />
  <!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="/front_7th/favicon.ico"/>
  <!--app-head-->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6J8QP7YK1E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-6J8QP7YK1E');
  </script>
  <script type="module" crossorigin src="/front_7th/assets/index-C-edMQf_.js"></script>
  <link rel="stylesheet" crossorigin href="/front_7th/assets/index-B1cXSvNG.css">
</head>
<body>
<div id="root"><!--app-html--></div>
</body>
</html>
